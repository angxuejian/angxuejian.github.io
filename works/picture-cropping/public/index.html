<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片裁剪</title>
  <link rel="stylesheet" href="./index.css">
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #app {
      background-color: #000;
      /* max-width: 450px;
      min-width: 320px; */
      height: 100%;
      width: 100%;
      overflow: hidden;

      /* position: relative;
      display: flex;
      align-items: center;
      justify-content: center; */
    }
  </style>
</head>

<body>

  <div id="app">

    <input onchange="getFile(event)" type="file" accept="image/*">

    <img class="prev none" src="" alt="">

    <canvas id="canvas"></canvas>

  </div>

  <script>
    const input = document.getElementsByTagName('input')[0]
    const canvas = document.getElementById('canvas')
    const prev = document.getElementsByClassName('prev')[0]

    let pageX = 0
    let pageY = 0

    let startX = 0
    let startY = 0
    let isTouch = false



    function getFile(event) {
      const file = event.target.files[0]

      const reader = new FileReader()
      reader.readAsDataURL(file)
      reader.onload = function() {

        drawImage(reader.result) 
      }
    }

   
    function drawImage(src) {
      canvas.width  = 375
      canvas.height = 812
      const ctx = canvas.getContext('2d')

      const img = new Image()

      img.src = src || './assets/a.jpg'
      img.onload = function () {
       
        const [dw, dh] = getAspectFill(img.width, img.height, 450, 450)
 
        ctx.drawImage(img, (375 - dw) / 2, (812 - dh) / 2, dw, dh)

        // prev.src = canvas.toDataURL('image/jpeg', 1)
        // return
        const img2 = new Image()
        img2.src = './assets/bc.png'
        img2.onload = function() {
          ctx.globalAlpha = 0.8
          ctx.drawImage(img2, 0, 0, 375, 812)

          prev.classList.remove('none')
          input.classList.add('none')
          prev.src = canvas.toDataURL('image/jpeg', 1)
        }

       
      }
    }


    function getAspectFill(width, height, styleW, styleH) {
  
      let [dw, dh] = []
      let scale = width / height

      // 判断图片的短边是宽还是高
      if (width < height) {
        dw = styleW
        dh = styleW / scale
      } else {
        dw = styleH * scale
        dh = styleH
      }

      return [dw, dh]
      }
  </script>
</body>

</html>